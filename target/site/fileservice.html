<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-07-22 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150722" />
    <meta http-equiv="Content-Language" content="en" />
    <title>AludraTest &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>AludraTest</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-07-22
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 3.0.1
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Introduction</li>
                              
      <li>
  
                          <a href="general.html" title="General">
          <i class="none"></i>
        General</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="core-concept.html" title="Core Concept">
          <i class="icon-chevron-right"></i>
        Core Concept</a>
                  </li>
                              <li class="nav-header">Guides</li>
                                                                                                                                                                                                                                
      <li>
  
                          <a href="setup-environment.html" title="Getting Started">
          <i class="icon-chevron-right"></i>
        Getting Started</a>
                  </li>
                                                                                                                                                    
      <li>
  
                          <a href="aludratest-services.html" title="Services">
          <i class="icon-chevron-down"></i>
        Services</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="service-configuration.html" title="Service Configuration">
          <i class="none"></i>
        Service Configuration</a>
            </li>
                    
      <li>
  
                          <a href="webguiservice.html" title="Web GUI Service">
          <i class="none"></i>
        Web GUI Service</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><i class="none"></i>File Service</a>
          </li>
                    
      <li>
  
                          <a href="flatfileservice.html" title="Flat File Service">
          <i class="none"></i>
        Flat File Service</a>
            </li>
                    
      <li>
  
                          <a href="separatedfileservice.html" title="Separated File Service">
          <i class="none"></i>
        Separated File Service</a>
            </li>
              </ul>
        </li>
                                                                                                                        
      <li>
  
                          <a href="aludratest-developer-guide.html" title="Extend AludraTest">
          <i class="icon-chevron-right"></i>
        Extend AludraTest</a>
                  </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                    
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <?xml version='1.0' encoding='utf-8' ?><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><p>The FileService service gives access to files and file systems on local or remote drives as well as on FTP, SFTP, HTTP and HTTPS servers.</p><h2 id="Configuration">Configuration</h2><p>The configuration files have the base name <b>fileService.properties</b> and support the following configuration properties:</p><div class="source"><pre class="prettyprint"># protocol can be file, ftp, sftp or http
protocol=file

base.url=${user.dir}

writing.permitted=false

#linefeed can be either WINDOWS or LINUX
linefeed=WINDOWS

encoding=UTF-8

# for remote systems
user=myuser
password=1234

wait.timeout=5000
wait.max.retries=4
</pre></div><dl><dt>protocol (required)</dt><dd><b>file</b> for local or remote drive access</dd><dd><b>ftp</b> for regular FTP server access</dd><dd><b>sftp</b> for SFTP-based (secure) FTP server access</dd><dd><b>http</b> for HTTP-based web server access</dd><dd><b>https</b> for HTTPS-based (secure) web server access</dd></dl><dl><dt>base.url (required)</dt><dd>the base URL of the file system, e.g.</dd><dd><b>src/test/resources/fileService</b> for a local directory or</dd><dd><b>testftp.myacme.com:2121/users/aludratest</b> for an FTP server directory (optionally with special port)</dd></dl><dl><dt>writing.permitted (default false)</dt><dd>flag (true or false), which defines if the service may modify files on the connected file system.</dd><dd>It applies to content modifications as well as copy, move or delete operations.</dd><dd>If a modififying operation is called and writing.permitted is false, an IllegalOperationException is thrown.</dd></dl><dl><dt>linefeed (required)</dt><dd>The linefeed style used on the file system</dd><dd><b>WINDOWS</b> for Windows-style linefeeds (\r\n)</dd><dd><b>UNIX</b> for Unix-style linefeeds (\n)</dd></dl><dl><dt>encoding (required)</dt><dd>The file system encoding used on the file system; usually UTF-8</dd></dl><dl><dt>user (optional)</dt><dd>The user name to use for login, e.g. on an FTP server</dd></dl><dl><dt>password (optional)</dt><dd>The password to use for login, e.g. on an FTP server</dd></dl><dl><dt>wait.timeout (default 30 sec)</dt><dd>The maximum number of milliseconds to wait for a file</dd></dl><dl><dt>wait.max.retries (default 15)</dt><dd>The maximum number of polling attemps when waiting for a file, the polling interval results from the fraction wait-timeout / wait.max.retries (default: 2 sec)</dd></dl><p>For information on how and where to configure these properties, please refer to <a href="./service-configuration.html" title="Service Configuration">Service Configuration</a>.</p><h2 id="Usage">Usage</h2><h3 id="Accessing_a_FileService_instance">Accessing a FileService instance</h3><p>A FileService instance defined as above is retrieved in the test class code by inheriting the test class from <b>AludraTestCase</b> and calling the method getService().</p><p>Example:</p><div class="source"><pre class="prettyprint">import java.util.List;
import org.aludratest.testcase.Test;
import org.aludratest.testcase.AludraTestCase;
import org.aludratest.service.ComponentId;
import org.aludratest.service.file.FileService;

public class ExampleFsTest extends AludraTestCase {
   @Test
   public void test() {
       FileService fileService = getService(ComponentId.create(FileService.class, "myservice"));
       List&lt;String> children = fileService.perform().getChildren("/");
       for (String child : children) {
           System.out.println(child);
       }
   }
}
</pre></div><h3 id="FileService_API">FileService API</h3><p>The FileService interface gives access to three action interfaces by which you can perform interactions, verifications and checks on a file system:</p><div class="source"><pre class="prettyprint">public interface FileService extends AludraService {
   FileInteraction perform();
   FileVerification verify();
   FileCondition check();
}
</pre></div><p><img border="0" src="./images/AludraTest-FileService-API.png"/></p><h3 id="Files_and_Paths">Files and Paths</h3><p>A file is identified by its file <b>path relative to the the service's root directory</b>.</p><p>So, "/" refers to the base URL as defined in the fileService properties and may internally resolve to an absolute path such as /home/myuser/testdata/fileService/. Consequentially, path names like "/subfolder/test.txt" and "subfolder/test.txt" would resolve to the same file.</p><h3 id="Overwriting_Files">Overwriting Files</h3><p>Several operations which create, move or copy files have an <b>overwrite</b> parameter. When set to true, existing files are silently overwritten. When set to false and the operation encounters an existing file, a <b>FunctionalFailure</b> is thrown.</p><h3 id="Reading_and_writing_file_content">Reading and writing file content</h3><p>File content can be written and read via FileInteraction using text mode or binary mode methods. Text mode operations automatically convert character encoding and linefeed style between the OS on which the JVM is running and the configured (local or remote) file system.</p><h4 id="One-Liners">One-Liners</h4><p>There are methods which make file creation/reading a one-liner (read/WriteText/BinaryFile()): You provide the file name, the file content (as string or byte array) and specify whether existing files shall be overwritten. That's it.</p><p>Example:</p><div class="source"><pre class="prettyprint">String content = fileService.perform().readTextFile("file.txt");
System.out.println("File Content: " + content);
</pre></div><p><br/>However, for very large files, this may not be viable and you need to use streaming.</p><h4 id="Stream-based_Writing">Stream-based Writing</h4><p>For <b>writing files</b>, this requires two steps:</p><ol><li>Create an OutputStream (for binary data) or Reader (for text data) which provides the content to write</li><li>Call writeBinaryFile() or writeTextFile() to perform the writing. When the method has finished, it closes the stream that you provided.</li></ol><p>Example:</p><div class="source"><pre class="prettyprint">FileService fileService = getService(new ServiceId("localtest", FileService.class));
StringReader reader = new StringReader("Content to save");        // step 1.
fileService.perform().writeTextFile("newFile.txt", reader, true); // step 2.
</pre></div><h4 id="Stream-based_Reading">Stream-based Reading</h4><p><b>Reading file content</b> requires one more step:</p><ol><li>Retrieving an InputStream (for binary data) or a Reader (for text data) from the FileService using getInputStreamForFile() or getReaderForTextFile()</li><li>Iterating through the data in your test code</li><li>Closing the stream obtained in step 1 calling the close() method</li></ol><p>Hint: The method getReaderForTextFile() returns a BufferedReader whose readLine() method can be used to iterate through the stream linewise.</p><p>Attention: When iterating the Reader character by character, line feeds are not converted between the service's file system and the JVM's.</p><p>Example:</p><div class="source"><pre class="prettyprint">BufferedReader reader = null;
try {
   reader = fileService.perform().getReaderForTextFile("file.txt"); // step 1
   String s;
   while ((s = reader.readLine())&nbsp;= null) {                        // step 2
       System.out.println(line);
   }
} finally {
   IOUtil.close(reader);                                            // step 3
}
</pre></div><h3 id="Selecting_files_using_a_FileFilter">Selecting files using a FileFilter</h3><p>If there is limited knowledge about the file name to open (e.g. because its name contains a timestamp), you can provide FileService operations (getChildren() and waitForFirstMatch()) with a FileFilter implementation. This needs to implement an accept() method which is provided with a FileInfo object which is called for each file and provides file name, path, size, lastModifiedTime and wether it is a drirectory. The accept() method needs to return true for each file that is accepted.</p><p><br/>A set of predefined FileFilter implementations enables you to compose even complex filters without having to develop your own:</p><p><br/><img border="0" src="./images/AludraTest-FileFilter.png"/></p><p><br/>An example to illustrate the composition:</p><p>In order to search for a file named <b>BAPLIE_&lt;Date&gt;_&lt;Company&gt;_&lt;Sequence&gt;.EDI</b> which has been put on the file system on 2013-11-13 after 9:00 AM, one can combine a RegexFilePathFilter with a LastModifiedTimeFileFilter using the AndFileFilter:</p><div class="source"><pre class="prettyprint">FileService fileService = getService(new ServiceId("localtest", FileService.class));
RegexFilePathFilter regexFilter = new RegexFilePathFilter("BAPLIE_[0-9]{4}-[0-9]{2}-[0-9]{2}_[A-Z]+_[0-9]*\\.EDI");
long minTimestamp = new GregorianCalendar(2013, 10, 13, 9, 0).getTimeInMillis();
LastModifiedTimeFileFilter timeFilter = new LastModifiedTimeFileFilter(minTimestamp, null);
FileFilter filter = new AndFileFilter(regexFilter, timeFilter);
List&lt;String> matches = fileService.perform().getChildren("/", filter);
for (String match&nbsp; matches)
   System.out.println(match);
</pre></div><h3 id="Polling">Polling</h3><p>There may be cases in which you trigger a process on the SUT which results in the creation of a file which you want to read for validation. Since the operation may be a lengthy process, the FileService provides a polling feature: You provide a file path or a FileFilter for selecting the file and make the FileService poll the file system for you (calling waitUntilExists() or waitForFirstMatch()). The timeout and the maximum number of polling operations is configured in the fileService.properties file. When no match was found before timeout, a FunctionalFailure is thrown.</p><p>Example:</p><div class="source"><pre class="prettyprint">String expectedFile = "results.txt";
fileService.perform().waitUntilExists(expectedFile); // this throws a FunctionalFailure if the file does not appear within timeout
String content = fileService.perform().readTextFile(expectedFile);
System.out.println(content);
</pre></div><h3 id="FileVerification_API">FileVerification API</h3><div class="source"><pre class="prettyprint">public interface FileVerification extends Verification {
   public void assertPresence(String filePath);
   public void assertAbsence(String filePath);
}
</pre></div><p>The assert* methods throw an FunctionalFailure exception when the asserted condition is not fulfilled.</p><h3 id="FileCondition_API">FileCondition API</h3><div class="source"><pre class="prettyprint">public interface FileCondition extends Condition {
   public boolean exists(String filePath);
   boolean isDirectory(String filePath);
}
</pre></div></body></html>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2015
                        <a href="http://www.aludratest.org/">aludratest.org</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
